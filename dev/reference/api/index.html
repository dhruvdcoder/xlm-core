
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A Unified Framework for Non-Autoregressive Language Models">
      
      
      
        <link rel="canonical" href="https://dhruvdcoder.github.io/xlm-core/dev/reference/api/">
      
      
        <link rel="prev" href="../../guide/releasing/">
      
      
        <link rel="next" href="../api-models/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>API (xlm-core) - XLM</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-reference-xlm-core" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="XLM" class="md-header__button md-logo" aria-label="XLM" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            XLM
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API (xlm-core)
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/dhruvdcoder/xlm-core" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    dhruvdcoder/xlm-core
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guide/quickstart/" class="md-tabs__link">
          
  
  
  Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../guide/building-docs/" class="md-tabs__link">
          
  
  
  Developers

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
  Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="XLM" class="md-nav__button md-logo" aria-label="XLM" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    XLM
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dhruvdcoder/xlm-core" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    dhruvdcoder/xlm-core
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Guide
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Guide
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/design/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Design
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/training/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Training
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/generation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Generation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/external-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    External Models
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contributing
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FAQ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Developers
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Developers
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/building-docs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Building Docs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/releasing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Releasing to PyPI
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    API (xlm-core)
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    API (xlm-core)
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#core" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.model" class="md-nav__link">
    <span class="md-ellipsis">
      
        model
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.harness" class="md-nav__link">
    <span class="md-ellipsis">
      
        harness
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.harness.Harness" class="md-nav__link">
    <span class="md-ellipsis">
      
        Harness
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Harness">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.harness.Harness.tokenizer" class="md-nav__link">
    <span class="md-ellipsis">
      
        tokenizer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.harness.Harness.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.harness.Harness.compute_loss" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_loss
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.harness.Harness.compute_post_hoc_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_post_hoc_metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.harness.Harness.create_lr_scheduler" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_lr_scheduler
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.harness.Harness.extract_model_weights" class="md-nav__link">
    <span class="md-ellipsis">
      
        extract_model_weights
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.harness.Harness.from_checkpoint" class="md-nav__link">
    <span class="md-ellipsis">
      
        from_checkpoint
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="from_checkpoint">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.harness.Harness.from_checkpoint--load-with-ema-weights-applied" class="md-nav__link">
    <span class="md-ellipsis">
      
        Load with EMA weights applied
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.harness.Harness.load_model_from_hub" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_model_from_hub
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.harness.Harness.load_model_weights" class="md-nav__link">
    <span class="md-ellipsis">
      
        load_model_weights
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.harness.Harness.prepare_batch_for_prediction" class="md-nav__link">
    <span class="md-ellipsis">
      
        prepare_batch_for_prediction
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.harness.Harness.save_model_weights" class="md-nav__link">
    <span class="md-ellipsis">
      
        save_model_weights
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.harness.Harness.setup_metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        setup_metrics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.harness.Harness.setup_post_hoc_evaluator" class="md-nav__link">
    <span class="md-ellipsis">
      
        setup_post_hoc_evaluator
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.harness.LRSchedulerWithConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        LRSchedulerWithConfig
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.harness.Predictor" class="md-nav__link">
    <span class="md-ellipsis">
      
        Predictor
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Predictor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.harness.Predictor.to_dict" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_dict
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.harness.PredictorHistoryMixin" class="md-nav__link">
    <span class="md-ellipsis">
      
        PredictorHistoryMixin
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PredictorHistoryMixin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.harness.PredictorHistoryMixin.create_history" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_history
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.harness.PredictorHistoryMixin.format_history_for_output" class="md-nav__link">
    <span class="md-ellipsis">
      
        format_history_for_output
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.harness.PredictorHistoryMixin.init_history" class="md-nav__link">
    <span class="md-ellipsis">
      
        init_history
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.harness.PredictorHistoryMixin.update_history_explicit" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_history_explicit
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.harness.PredictorHistoryMixin.update_history_from_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_history_from_state
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.datamodule" class="md-nav__link">
    <span class="md-ellipsis">
      
        datamodule
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.datamodule.BaseBatch" class="md-nav__link">
    <span class="md-ellipsis">
      
        BaseBatch
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.datamodule.BaseCollatorInput" class="md-nav__link">
    <span class="md-ellipsis">
      
        BaseCollatorInput
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.datamodule.BaseDataModule" class="md-nav__link">
    <span class="md-ellipsis">
      
        BaseDataModule
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BaseDataModule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.datamodule.BaseDataModule.tokenizer" class="md-nav__link">
    <span class="md-ellipsis">
      
        tokenizer
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.datamodule.BaseDataModule.print_batch" class="md-nav__link">
    <span class="md-ellipsis">
      
        print_batch
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.datamodule.DefaultCollator" class="md-nav__link">
    <span class="md-ellipsis">
      
        DefaultCollator
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.datamodule.DefaultCollatorWithDynamicPadding" class="md-nav__link">
    <span class="md-ellipsis">
      
        DefaultCollatorWithDynamicPadding
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.datamodule.DefaultCollatorWithPadding" class="md-nav__link">
    <span class="md-ellipsis">
      
        DefaultCollatorWithPadding
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.datamodule.DefaultEmptyDataset" class="md-nav__link">
    <span class="md-ellipsis">
      
        DefaultEmptyDataset
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DefaultEmptyDataset">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.datamodule.DefaultEmptyDataset.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.datamodule.Seq2SeqCollatorInput" class="md-nav__link">
    <span class="md-ellipsis">
      
        Seq2SeqCollatorInput
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.datamodule.SimpleSpaceTokenizer" class="md-nav__link">
    <span class="md-ellipsis">
      
        SimpleSpaceTokenizer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SimpleSpaceTokenizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.datamodule.SimpleSpaceTokenizer.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.datamodule.TokenizerMixin" class="md-nav__link">
    <span class="md-ellipsis">
      
        TokenizerMixin
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TokenizerMixin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.datamodule.TokenizerMixin.post_creation" class="md-nav__link">
    <span class="md-ellipsis">
      
        post_creation
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.datamodule.UnconditionalGenerationDatasetManager" class="md-nav__link">
    <span class="md-ellipsis">
      
        UnconditionalGenerationDatasetManager
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.datamodule.ids_to_example_fn" class="md-nav__link">
    <span class="md-ellipsis">
      
        ids_to_example_fn
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.datamodule.pad_prefix_suffix" class="md-nav__link">
    <span class="md-ellipsis">
      
        pad_prefix_suffix
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.datamodule.pad_prefix_suffix2" class="md-nav__link">
    <span class="md-ellipsis">
      
        pad_prefix_suffix2
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.metrics" class="md-nav__link">
    <span class="md-ellipsis">
      
        metrics
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.metrics.ExactMatch" class="md-nav__link">
    <span class="md-ellipsis">
      
        ExactMatch
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ExactMatch">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.metrics.ExactMatch.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.metrics.MetricWrapper" class="md-nav__link">
    <span class="md-ellipsis">
      
        MetricWrapper
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MetricWrapper">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.metrics.MetricWrapper.full_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        full_name
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.metrics.MetricWrapper.compute" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.metrics.MetricWrapper.get_log_dict" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_log_dict
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.metrics.MetricWrapper.log" class="md-nav__link">
    <span class="md-ellipsis">
      
        log
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.metrics.MetricWrapper.reset" class="md-nav__link">
    <span class="md-ellipsis">
      
        reset
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.metrics.MetricWrapper.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.metrics.TokenAccuracy" class="md-nav__link">
    <span class="md-ellipsis">
      
        TokenAccuracy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TokenAccuracy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.metrics.TokenAccuracy.update" class="md-nav__link">
    <span class="md-ellipsis">
      
        update
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.metrics.exact_match_update_fn" class="md-nav__link">
    <span class="md-ellipsis">
      
        exact_match_update_fn
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.metrics.seq2seq_exact_match_update_fn" class="md-nav__link">
    <span class="md-ellipsis">
      
        seq2seq_exact_match_update_fn
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.metrics.seq2seq_token_accuracy_update_fn" class="md-nav__link">
    <span class="md-ellipsis">
      
        seq2seq_token_accuracy_update_fn
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.noise" class="md-nav__link">
    <span class="md-ellipsis">
      
        noise
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.flags" class="md-nav__link">
    <span class="md-ellipsis">
      
        flags
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#commands" class="md-nav__link">
    <span class="md-ellipsis">
      
        Commands
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.commands.lightning_train" class="md-nav__link">
    <span class="md-ellipsis">
      
        lightning_train
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.commands.lightning_generate" class="md-nav__link">
    <span class="md-ellipsis">
      
        lightning_generate
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.commands.lightning_generate.instantiate_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        instantiate_model
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.commands.lightning_eval" class="md-nav__link">
    <span class="md-ellipsis">
      
        lightning_eval
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.commands.lightning_eval.instantiate_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        instantiate_model
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.commands.lightning_prepare_data" class="md-nav__link">
    <span class="md-ellipsis">
      
        lightning_prepare_data
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.commands.push_to_hub" class="md-nav__link">
    <span class="md-ellipsis">
      
        push_to_hub
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.commands.push_to_hub.PushToHubConfig" class="md-nav__link">
    <span class="md-ellipsis">
      
        PushToHubConfig
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.commands.push_to_hub.instantiate_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        instantiate_model
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.commands.push_to_hub.main" class="md-nav__link">
    <span class="md-ellipsis">
      
        main
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.commands.scaffold_model" class="md-nav__link">
    <span class="md-ellipsis">
      
        scaffold_model
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.commands.scaffold_model.create_template_context" class="md-nav__link">
    <span class="md-ellipsis">
      
        create_template_context
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.commands.scaffold_model.generate_config_files" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_config_files
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.commands.scaffold_model.generate_datamodule_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_datamodule_file
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.commands.scaffold_model.generate_documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_documentation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.commands.scaffold_model.generate_init_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_init_file
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.commands.scaffold_model.generate_loss_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_loss_file
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.commands.scaffold_model.generate_metrics_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_metrics_file
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.commands.scaffold_model.generate_model_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_model_file
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.commands.scaffold_model.generate_predictor_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_predictor_file
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.commands.scaffold_model.generate_setup_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_setup_file
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.commands.scaffold_model.generate_types_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_types_file
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.commands.scaffold_model.update_xlm_models_file" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_xlm_models_file
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.commands.scaffold_model.validate_model_name" class="md-nav__link">
    <span class="md-ellipsis">
      
        validate_model_name
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modules" class="md-nav__link">
    <span class="md-ellipsis">
      
        Modules
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.rotary_transformer" class="md-nav__link">
    <span class="md-ellipsis">
      
        rotary_transformer
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.rotary_transformer.RotaryTransformerFinalLayer" class="md-nav__link">
    <span class="md-ellipsis">
      
        RotaryTransformerFinalLayer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RotaryTransformerFinalLayer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.modules.rotary_transformer.RotaryTransformerFinalLayer.forward" class="md-nav__link">
    <span class="md-ellipsis">
      
        forward
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.rotary_transformer.RotaryTransformerFinalLayerForClassification" class="md-nav__link">
    <span class="md-ellipsis">
      
        RotaryTransformerFinalLayerForClassification
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RotaryTransformerFinalLayerForClassification">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.modules.rotary_transformer.RotaryTransformerFinalLayerForClassification.forward" class="md-nav__link">
    <span class="md-ellipsis">
      
        forward
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.rotary_transformer.RotaryTransformerLayer" class="md-nav__link">
    <span class="md-ellipsis">
      
        RotaryTransformerLayer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RotaryTransformerLayer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.modules.rotary_transformer.RotaryTransformerLayer.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.modules.rotary_transformer.RotaryTransformerLayer.apply_rotary_pos_emb" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply_rotary_pos_emb
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.modules.rotary_transformer.RotaryTransformerLayer.forward" class="md-nav__link">
    <span class="md-ellipsis">
      
        forward
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.rotary_transformer.RotaryTransformerLayerList" class="md-nav__link">
    <span class="md-ellipsis">
      
        RotaryTransformerLayerList
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.rotary_transformer.add_bias_apply_dropout_scale" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_bias_apply_dropout_scale
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.gpt2_transformer" class="md-nav__link">
    <span class="md-ellipsis">
      
        gpt2_transformer
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.gpt2_transformer.GPT" class="md-nav__link">
    <span class="md-ellipsis">
      
        GPT
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GPT">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.modules.gpt2_transformer.GPT.estimate_mfu" class="md-nav__link">
    <span class="md-ellipsis">
      
        estimate_mfu
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.modules.gpt2_transformer.GPT.get_num_params" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_num_params
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.gpt2_transformer.LayerNorm" class="md-nav__link">
    <span class="md-ellipsis">
      
        LayerNorm
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.encoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        encoder
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.encoder.DiffusionTransformerEncoder" class="md-nav__link">
    <span class="md-ellipsis">
      
        DiffusionTransformerEncoder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DiffusionTransformerEncoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.modules.encoder.DiffusionTransformerEncoder.forward" class="md-nav__link">
    <span class="md-ellipsis">
      
        forward
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.encoder.DiffusionTransformerEncoderLayer" class="md-nav__link">
    <span class="md-ellipsis">
      
        DiffusionTransformerEncoderLayer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DiffusionTransformerEncoderLayer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.modules.encoder.DiffusionTransformerEncoderLayer.forward" class="md-nav__link">
    <span class="md-ellipsis">
      
        forward
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple" class="md-nav__link">
    <span class="md-ellipsis">
      
        ddit_simple
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple.AdaLNModulations" class="md-nav__link">
    <span class="md-ellipsis">
      
        AdaLNModulations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AdaLNModulations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple.AdaLNModulations.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple.AdaLNModulations.ada_ln_modulate" class="md-nav__link">
    <span class="md-ellipsis">
      
        ada_ln_modulate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple.AdaLNModulations.forward" class="md-nav__link">
    <span class="md-ellipsis">
      
        forward
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple.DDiTLayer" class="md-nav__link">
    <span class="md-ellipsis">
      
        DDiTLayer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DDiTLayer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple.DDiTLayer.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple.DDiTLayer.apply_rotary_pos_emb" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply_rotary_pos_emb
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple.DDiTLayer.forward" class="md-nav__link">
    <span class="md-ellipsis">
      
        forward
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple.DDiTLayerList" class="md-nav__link">
    <span class="md-ellipsis">
      
        DDiTLayerList
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple.DDitFinalLayer" class="md-nav__link">
    <span class="md-ellipsis">
      
        DDitFinalLayer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DDitFinalLayer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple.DDitFinalLayer.forward" class="md-nav__link">
    <span class="md-ellipsis">
      
        forward
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple.LabelEmbedder" class="md-nav__link">
    <span class="md-ellipsis">
      
        LabelEmbedder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LabelEmbedder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple.LabelEmbedder.drop_labels" class="md-nav__link">
    <span class="md-ellipsis">
      
        drop_labels
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple.LabelEmbedder.forward" class="md-nav__link">
    <span class="md-ellipsis">
      
        forward
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple.LayerNormAndScale" class="md-nav__link">
    <span class="md-ellipsis">
      
        LayerNormAndScale
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LayerNormAndScale">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple.LayerNormAndScale.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple.LayerNormAndScale.forward" class="md-nav__link">
    <span class="md-ellipsis">
      
        forward
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple.TimestepEmbedder" class="md-nav__link">
    <span class="md-ellipsis">
      
        TimestepEmbedder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TimestepEmbedder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple.TimestepEmbedder.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple.TimestepEmbedder.forward" class="md-nav__link">
    <span class="md-ellipsis">
      
        forward
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple.add_bias_apply_dropout_scale" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_bias_apply_dropout_scale
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple_v2" class="md-nav__link">
    <span class="md-ellipsis">
      
        ddit_simple_v2
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple_v2.AdaLNModulations" class="md-nav__link">
    <span class="md-ellipsis">
      
        AdaLNModulations
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="AdaLNModulations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple_v2.AdaLNModulations.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple_v2.AdaLNModulations.ada_ln_modulate" class="md-nav__link">
    <span class="md-ellipsis">
      
        ada_ln_modulate
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple_v2.AdaLNModulations.forward" class="md-nav__link">
    <span class="md-ellipsis">
      
        forward
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple_v2.DDiTLayer" class="md-nav__link">
    <span class="md-ellipsis">
      
        DDiTLayer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DDiTLayer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple_v2.DDiTLayer.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple_v2.DDiTLayer.apply_rotary_pos_emb" class="md-nav__link">
    <span class="md-ellipsis">
      
        apply_rotary_pos_emb
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple_v2.DDiTLayer.forward" class="md-nav__link">
    <span class="md-ellipsis">
      
        forward
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple_v2.DDiTLayerList" class="md-nav__link">
    <span class="md-ellipsis">
      
        DDiTLayerList
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple_v2.DDitFinalLayer" class="md-nav__link">
    <span class="md-ellipsis">
      
        DDitFinalLayer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DDitFinalLayer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple_v2.DDitFinalLayer.forward" class="md-nav__link">
    <span class="md-ellipsis">
      
        forward
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple_v2.DDitFinalLayerForClassification" class="md-nav__link">
    <span class="md-ellipsis">
      
        DDitFinalLayerForClassification
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DDitFinalLayerForClassification">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple_v2.DDitFinalLayerForClassification.forward" class="md-nav__link">
    <span class="md-ellipsis">
      
        forward
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple_v2.DDitFinalLayerWithoutNormalization" class="md-nav__link">
    <span class="md-ellipsis">
      
        DDitFinalLayerWithoutNormalization
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DDitFinalLayerWithoutNormalization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple_v2.DDitFinalLayerWithoutNormalization.forward" class="md-nav__link">
    <span class="md-ellipsis">
      
        forward
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple_v2.LabelEmbedder" class="md-nav__link">
    <span class="md-ellipsis">
      
        LabelEmbedder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LabelEmbedder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple_v2.LabelEmbedder.drop_labels" class="md-nav__link">
    <span class="md-ellipsis">
      
        drop_labels
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple_v2.LabelEmbedder.forward" class="md-nav__link">
    <span class="md-ellipsis">
      
        forward
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple_v2.LayerNormAndScale" class="md-nav__link">
    <span class="md-ellipsis">
      
        LayerNormAndScale
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LayerNormAndScale">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple_v2.LayerNormAndScale.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple_v2.LayerNormAndScale.forward" class="md-nav__link">
    <span class="md-ellipsis">
      
        forward
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple_v2.TimestepEmbedder" class="md-nav__link">
    <span class="md-ellipsis">
      
        TimestepEmbedder
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TimestepEmbedder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple_v2.TimestepEmbedder.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple_v2.TimestepEmbedder.forward" class="md-nav__link">
    <span class="md-ellipsis">
      
        forward
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.ddit_simple_v2.add_bias_apply_dropout_scale" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_bias_apply_dropout_scale
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.position" class="md-nav__link">
    <span class="md-ellipsis">
      
        position
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.modules.position.RotaryEmbedding" class="md-nav__link">
    <span class="md-ellipsis">
      
        RotaryEmbedding
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="RotaryEmbedding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.modules.position.RotaryEmbedding.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.modules.position.RotaryEmbedding.forward" class="md-nav__link">
    <span class="md-ellipsis">
      
        forward
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tasks" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tasks
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.tasks.owt" class="md-nav__link">
    <span class="md-ellipsis">
      
        owt
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.tasks.lm1b" class="md-nav__link">
    <span class="md-ellipsis">
      
        lm1b
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.tasks.lm1b.detokenizer_lm1b_string" class="md-nav__link">
    <span class="md-ellipsis">
      
        detokenizer_lm1b_string
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.tasks.star" class="md-nav__link">
    <span class="md-ellipsis">
      
        star
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.tasks.star.plot_graph" class="md-nav__link">
    <span class="md-ellipsis">
      
        plot_graph
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.tasks.star.simple_star_graph" class="md-nav__link">
    <span class="md-ellipsis">
      
        simple_star_graph
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="simple_star_graph">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.tasks.star.simple_star_graph--adapted-from-httpsgithubcomgregorbachmannnext-token-failuresblobmaindatagraphspy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Adapted from : https://github.com/gregorbachmann/Next-Token-Failures/blob/main/data/graphs.py
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.tasks.molgen" class="md-nav__link">
    <span class="md-ellipsis">
      
        molgen
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.tasks.molgen.DeNovoEval" class="md-nav__link">
    <span class="md-ellipsis">
      
        DeNovoEval
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DeNovoEval">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.tasks.molgen.DeNovoEval.evaluator_diversity" class="md-nav__link">
    <span class="md-ellipsis">
      
        evaluator_diversity
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.tasks.molgen.DeNovoEval.evaluator_uniqueness" class="md-nav__link">
    <span class="md-ellipsis">
      
        evaluator_uniqueness
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.tasks.molgen.DeNovoEval.evaluator_validity" class="md-nav__link">
    <span class="md-ellipsis">
      
        evaluator_validity
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.tasks.molgen.DeNovoEval.oracle_qed" class="md-nav__link">
    <span class="md-ellipsis">
      
        oracle_qed
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.tasks.molgen.DeNovoEval.oracle_sa" class="md-nav__link">
    <span class="md-ellipsis">
      
        oracle_sa
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.tasks.molgen.DeNovoEval.eval" class="md-nav__link">
    <span class="md-ellipsis">
      
        eval
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.tasks.molgen.FragmentEval" class="md-nav__link">
    <span class="md-ellipsis">
      
        FragmentEval
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FragmentEval">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.tasks.molgen.FragmentEval.eval" class="md-nav__link">
    <span class="md-ellipsis">
      
        eval
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.tasks.molgen.SerializableSAFETokenizer" class="md-nav__link">
    <span class="md-ellipsis">
      
        SerializableSAFETokenizer
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SerializableSAFETokenizer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.tasks.molgen.SerializableSAFETokenizer.__dir__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __dir__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.tasks.molgen.SerializableSAFETokenizer.__getattr__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __getattr__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.tasks.molgen.SerializableSAFETokenizer.__getstate__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __getstate__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.tasks.molgen.SerializableSAFETokenizer.__setstate__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __setstate__
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.tasks.molgen.bracketsafe2safe" class="md-nav__link">
    <span class="md-ellipsis">
      
        bracketsafe2safe
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.tasks.molgen.genmol_fragment_preprocess_fn" class="md-nav__link">
    <span class="md-ellipsis">
      
        genmol_fragment_preprocess_fn
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.tasks.molgen.safe2bracketsafe" class="md-nav__link">
    <span class="md-ellipsis">
      
        safe2bracketsafe
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.tasks.molgen.safe_bracket_on_the_fly_processor_combined" class="md-nav__link">
    <span class="md-ellipsis">
      
        safe_bracket_on_the_fly_processor_combined
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.tasks.molgen.safe_strings_to_smiles" class="md-nav__link">
    <span class="md-ellipsis">
      
        safe_strings_to_smiles
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.tasks.molgen.safe_to_smiles" class="md-nav__link">
    <span class="md-ellipsis">
      
        safe_to_smiles
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.tasks.sudoku" class="md-nav__link">
    <span class="md-ellipsis">
      
        sudoku
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#utils" class="md-nav__link">
    <span class="md-ellipsis">
      
        Utils
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.utils.data" class="md-nav__link">
    <span class="md-ellipsis">
      
        data
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.utils.nn" class="md-nav__link">
    <span class="md-ellipsis">
      
        nn
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.utils.nn.add_exp_1_noise" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_exp_1_noise
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.utils.nn.add_gumbel_noise" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_gumbel_noise
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.utils.nn.dtype" class="md-nav__link">
    <span class="md-ellipsis">
      
        dtype
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="dtype">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.utils.nn.dtype--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.utils.nn.dtype--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.utils.nn.get_mask_from_sequence_lengths" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_mask_from_sequence_lengths
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.utils.nn.masked_mean" class="md-nav__link">
    <span class="md-ellipsis">
      
        masked_mean
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="masked_mean">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.utils.nn.masked_mean--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.utils.nn.masked_mean--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.utils.nn.masked_sum" class="md-nav__link">
    <span class="md-ellipsis">
      
        masked_sum
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="masked_sum">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.utils.nn.masked_sum--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      
        Parameters
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.utils.nn.masked_sum--returns" class="md-nav__link">
    <span class="md-ellipsis">
      
        Returns
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.utils.nn.sample_categorical" class="md-nav__link">
    <span class="md-ellipsis">
      
        sample_categorical
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.utils.nn.sample_from_logits" class="md-nav__link">
    <span class="md-ellipsis">
      
        sample_from_logits
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.utils.nn.sample_from_top_k" class="md-nav__link">
    <span class="md-ellipsis">
      
        sample_from_top_k
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.utils.nn.sample_from_top_p" class="md-nav__link">
    <span class="md-ellipsis">
      
        sample_from_top_p
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.utils.nn.select_random_indices" class="md-nav__link">
    <span class="md-ellipsis">
      
        select_random_indices
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.utils.nn.tiny_value_of_dtype" class="md-nav__link">
    <span class="md-ellipsis">
      
        tiny_value_of_dtype
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.utils.ddp" class="md-nav__link">
    <span class="md-ellipsis">
      
        ddp
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.utils.ema" class="md-nav__link">
    <span class="md-ellipsis">
      
        ema
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#xlm.utils.ema.EMACallback" class="md-nav__link">
    <span class="md-ellipsis">
      
        EMACallback
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="EMACallback">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#xlm.utils.ema.EMACallback.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      
        __init__
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#xlm.utils.ema.EMACallback.on_train_end" class="md-nav__link">
    <span class="md-ellipsis">
      
        on_train_end
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../api-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API (xlm-models)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="api-reference-xlm-core">API Reference (xlm-core)</h1>
<h2 id="core">Core</h2>


<div class="doc doc-object doc-module">



<a id="xlm.model"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="xlm.harness"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="xlm.harness.Harness" class="doc doc-heading">
            <code>Harness</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="lightning.LightningModule">LightningModule</span></code>, <code><span title="huggingface_hub.PyTorchModelHubMixin">PyTorchModelHubMixin</span></code></p>



        <p>Main module that provides the scaffolding for the codebase.</p>











<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="xlm.harness.Harness.tokenizer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tokenizer</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Task
Metrics usually consist of two types of metrics:
    1. diagnostic metrics: These are typically different for different models as well as different tasks.
    2. reported metrics: These are the same for all the models but different for different tasks.
What we want too do is avoid a full blown (task x model) setup whenever we can but provide it as a last resort.
The best case scenario is complete decopling. This happens when all the models adhere to the same output signature.
But this never works for diagnostic metrics.
In some cases, different tasks can share base metrics of both types. In these cases, we can use inheritance to avoid some code duplication. We would still have (task x model) number of classes though.</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="xlm.harness.Harness.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">tokenizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">datamodule</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">write_per_sample_metrics</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize the Harness module.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cfg</code>
            </td>
            <td>
                  <code><span title="omegaconf.DictConfig">DictConfig</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration dictionary.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tokenizer</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="xlm.datamodule.Tokenizer">Tokenizer</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional tokenizer instance.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>datamodule</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="BaseDataModule (xlm.datamodule.BaseDataModule)" href="#xlm.datamodule.BaseDataModule">BaseDataModule</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional datamodule instance.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>write_per_sample_metrics</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to write per-sample metrics.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.harness.Harness.compute_loss" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_loss</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">batch_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dataloader_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dataloader_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Computes loss based on the dataloader name.</p>
<p>For 'lm', the loss function is applied.
For 'prediction', the predictor's predict_step is used.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.harness.Harness.compute_post_hoc_metrics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_post_hoc_metrics</span><span class="p">(</span><span class="n">split</span><span class="p">,</span> <span class="n">dataloader_name</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">update_logged_predictions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Compute post-hoc metrics on logged predictions.</p>
<p>Similar to compute_generative_perplexity, but for arbitrary post-hoc metrics.
Loads predictions from jsonl, computes per-sample and global metrics,
and logs aggregated results.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>split</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;train&#39;, &#39;val&#39;, &#39;test&#39;, &#39;predict&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>train/val/test/predict</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dataloader_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the dataloader</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>epoch</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current epoch</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>step</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current step</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>update_logged_predictions</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, update predictions jsonl with per-sample metrics</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of aggregated metrics, or None if no evaluator</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.harness.Harness.create_lr_scheduler" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_lr_scheduler</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">num_warmup_steps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fraction_warmup_steps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_training_steps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="s1">&#39;step&#39;</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;train_loss&#39;</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Creates a learning rate noise_schedule with the given configuration.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Huggingface name of the learning rate noise_schedule. https://huggingface.co/docs/transformers/en/main_classes/optimizer_schedules#transformers.get_scheduler</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>optimizer</code>
            </td>
            <td>
                  <code><span title="torch.optim.optimizer.Optimizer">Optimizer</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The optimizer to use with the noise_schedule</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_training_steps</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The total number of training steps.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_warmup_steps</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of warmup steps.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fraction_warmup_steps</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The fraction of training steps to use for warmup.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interval</code>
            </td>
            <td>
                  <code><span title="typing.Literal">Literal</span>[&#39;step&#39;, &#39;epoch&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The interval at which to update the learning rate.</p>
              </div>
            </td>
            <td>
                  <code>&#39;step&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>frequency</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The frequency of the learning rate updates.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>monitor</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The metric to monitor for the learning rate noise_schedule.</p>
              </div>
            </td>
            <td>
                  <code>&#39;train_loss&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>strict</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to strictly follow the learning rate schedule.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments to pass to the learning rate noise_schedule.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>LRSchedulerWithConfig</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="LRSchedulerWithConfig (xlm.harness.LRSchedulerWithConfig)" href="#xlm.harness.LRSchedulerWithConfig">LRSchedulerWithConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The configured learning rate scheduler.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.harness.Harness.extract_model_weights" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_model_weights</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Extract current model state dict.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model state dict (self.model.state_dict())</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.harness.Harness.from_checkpoint" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_checkpoint</span><span class="p">(</span><span class="n">checkpoint_path</span><span class="p">,</span> <span class="n">cfg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tokenizer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">datamodule</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">apply_ema</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">map_location</span><span class="o">=</span><span class="s1">&#39;cpu&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Load Harness from Lightning checkpoint with optional EMA application.</p>
<p>This is the ONLY method that can apply EMA weights, as it has direct access
to the checkpoint file containing the EMA state.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>checkpoint_path</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="pathlib.Path">Path</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the Lightning checkpoint file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cfg</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="omegaconf.DictConfig">DictConfig</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional config to override checkpoint config</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tokenizer</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="xlm.datamodule.Tokenizer">Tokenizer</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional tokenizer instance</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>datamodule</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<a class="autorefs autorefs-internal" title="BaseDataModule (xlm.datamodule.BaseDataModule)" href="#xlm.datamodule.BaseDataModule">BaseDataModule</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional datamodule instance</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>apply_ema</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to apply EMA weights from checkpoint</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>map_location</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Device to load checkpoint to</p>
              </div>
            </td>
            <td>
                  <code>&#39;cpu&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional arguments for load_from_checkpoint</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Harness (xlm.harness.Harness)" href="#xlm.harness.Harness">Harness</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Harness instance with loaded weights (and EMA applied if requested)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <h4 id="xlm.harness.Harness.from_checkpoint--load-with-ema-weights-applied">Load with EMA weights applied</h4>
<p>harness = Harness.from_checkpoint(
    "checkpoint.ckpt",
    apply_ema=True,
    cfg=cfg,
    tokenizer=tokenizer,
    datamodule=datamodule
)</p>
</details>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.harness.Harness.load_model_from_hub" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_model_from_hub</span><span class="p">(</span><span class="n">repo_id</span><span class="p">,</span> <span class="n">revision</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cache_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force_download</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">token</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Download and load model weights from HuggingFace Hub into self.model.</p>
<p>This method downloads the model weights from the hub and loads them into
the existing model. It does NOT reconstruct a new Harness instance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>repo_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HuggingFace Hub repository ID (e.g., "username/model")</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>revision</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Git revision (branch, tag, or commit)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cache_dir</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="pathlib.Path">Path</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Directory to cache downloaded files</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>force_download</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Force re-download even if cached</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>token</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="bool">bool</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HuggingFace Hub token for private repos</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>strict</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to strictly enforce that the keys match</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional arguments for hf_hub_download</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.harness.Harness.load_model_weights" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_model_weights</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Load model weights from local file into self.model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="pathlib.Path">Path</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the model weights file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>strict</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to strictly enforce that the keys match</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.harness.Harness.prepare_batch_for_prediction" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prepare_batch_for_prediction</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>We need this for some tasks even if we have task sepecific collator,
mainly because we want to clone some elements of the batch useful for computing metrics.
TODO: Get rid of this method by cloning in the collator itself.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.harness.Harness.save_model_weights" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_model_weights</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Save current model weights to local file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="pathlib.Path">Path</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the model weights</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>overwrite</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to overwrite existing file</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If file exists and overwrite is False</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.harness.Harness.setup_metrics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_metrics</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Attache metrics as modules</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.harness.Harness.setup_post_hoc_evaluator" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_post_hoc_evaluator</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Setup post-hoc evaluator. Can be use for tasks like molecule generation.</p>
<p>The post-hoc evaluator computes metrics on logged predictions at epoch end,
enabling global metric computation (e.g., diversity on full generated set).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cfg</code>
            </td>
            <td>
                  <code><span title="omegaconf.DictConfig">DictConfig</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration dictionary</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.harness.LRSchedulerWithConfig" class="doc doc-heading">
            <code>LRSchedulerWithConfig</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.TypedDict">TypedDict</span></code></p>



        <p>We follow the same structure as the one in LightningModule.
lr_scheduler_config = {
            # REQUIRED: The lr_scheduler instance
            "scheduler": lr_scheduler,
            # The unit of the lr_scheduler's step size, could also be 'step'.
            # 'epoch' updates the lr_scheduler on epoch end whereas 'step'
            # updates it after a optimizer update.
            "interval": "epoch",
            # How many epochs/steps should pass between calls to
            # <code>lr_scheduler.step()</code>. 1 corresponds to updating the learning
            # rate after every epoch/step.
            "frequency": 1,
            # Metric to to monitor for schedulers like <code>ReduceLROnPlateau</code>
            "monitor": "val_loss",
            # If set to <code>True</code>, will enforce that the value specified 'monitor'
            # is available when the lr_scheduler is updated, thus stopping
            # training if not found. If set to <code>False</code>, it will only produce a warning
            "strict": True,
        }</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.harness.Predictor" class="doc doc-heading">
            <code>Predictor</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Generic">Generic</span>[<span title="xlm.harness.T_in">T_in</span>, <span title="xlm.harness.T_out_pred">T_out_pred</span>]</code>, <code><span title="typing.Protocol">Protocol</span></code></p>













<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.harness.Predictor.to_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_dict</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">preds</span><span class="p">,</span> <span class="n">batch_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dataloader_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dataloader_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create json lines from the predictions batch.</p>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.harness.PredictorHistoryMixin" class="doc doc-heading">
            <code>PredictorHistoryMixin</code>


</h2>


    <div class="doc doc-contents ">



        <p>Mixin class for adding history tracking to predictors.</p>
<p>This mixin provides generic history tracking capabilities that can be
used by any predictor that implements iterative generation. History is
stored as a list of tuples: (decoded_text, confidence_score, step_number).</p>


<details class="usage" open>
  <summary>Usage</summary>
  <p>class MyPredictor(torch.nn.Module, PredictorHistoryMixin, Predictor[...]):
    def <strong>init</strong>(self, ..., return_history: bool = False):
        super().<strong>init</strong>()
        self.init_history(return_history=return_history)
        ...</p>
<pre><code>def predict(self, batch):
    history = self.create_history(batch_size)
    for step in range(steps):
        # ... generation logic ...
        history = self.update_history_from_state(history, state, step)
    return {"text": ..., "history": history}
</code></pre>
</details>










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.harness.PredictorHistoryMixin.create_history" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_history</span><span class="p">(</span><span class="n">batch_size</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Create empty history for a batch.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>batch_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of sequences in the batch.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="str">str</span>, <span title="float">float</span>, <span title="int">int</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Empty history list for each batch element.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.harness.PredictorHistoryMixin.format_history_for_output" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">format_history_for_output</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">round_precision</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Format history for output in to_dict methods.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>history</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="str">str</span>, <span title="float">float</span>, <span title="int">int</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Raw history list.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>round_precision</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of decimal places to round confidence values.</p>
              </div>
            </td>
            <td>
                  <code>4</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.List">List</span>[<span title="typing.List">List</span>[<span title="typing.Any">Any</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Formatted history with rounded confidence values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.harness.PredictorHistoryMixin.init_history" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">init_history</span><span class="p">(</span><span class="n">return_history</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">decode_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize history tracking.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>return_history</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to track history during generation.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>decode_fn</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Callable">Callable</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional custom decode function. If None, will use self.decode.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.harness.PredictorHistoryMixin.update_history_explicit" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_history_explicit</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">texts</span><span class="p">,</span> <span class="n">confidences</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">active_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update history with explicit values.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>history</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="str">str</span>, <span title="float">float</span>, <span title="int">int</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current history list.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>texts</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Decoded text for each batch element.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>confidences</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.List">List</span>[<span title="float">float</span>], <span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Confidence/score for each batch element.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>step</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current step number.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>active_mask</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="typing.List">List</span>[<span title="bool">bool</span>], <span title="torch.Tensor">Tensor</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional mask indicating which samples are still active.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="str">str</span>, <span title="float">float</span>, <span title="int">int</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated history.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.harness.PredictorHistoryMixin.update_history_from_state" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_history_from_state</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">confidence_key</span><span class="o">=</span><span class="s1">&#39;confidence&#39;</span><span class="p">,</span> <span class="n">active_mask_key</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update history from a state dictionary.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>history</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="str">str</span>, <span title="float">float</span>, <span title="int">int</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current history list.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>state</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing the current state (must be decodable).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>step</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Current step number.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>confidence_key</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Key in state dict for confidence values (default: "confidence").</p>
              </div>
            </td>
            <td>
                  <code>&#39;confidence&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>active_mask_key</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional key for mask indicating which samples are still active.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[<span title="str">str</span>, <span title="float">float</span>, <span title="int">int</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Updated history.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="xlm.datamodule"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="xlm.datamodule.BaseBatch" class="doc doc-heading">
            <code>BaseBatch</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.TypedDict">TypedDict</span></code></p>



        <p>Dict with the keys that are present in input batches for all models.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="xlm.datamodule.BaseBatch.input_ids">input_ids</span></code></td>
            <td>
                  <code><span title="jaxtyping.Integer">Integer</span>[<span title="torch.Tensor">Tensor</span>, &#39; batch seq_len&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input ids to the model.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="xlm.datamodule.BaseBatch.attention_mask">attention_mask</span></code></td>
            <td>
                  <code><span title="jaxtyping.Integer">Integer</span>[<span title="torch.Tensor">Tensor</span>, &#39; batch seq_len&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>1 for tokens that are not padding.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="xlm.datamodule.BaseBatch.token_type_ids">token_type_ids</span></code></td>
            <td>
                  <code><span title="jaxtyping.Integer">Integer</span>[<span title="torch.Tensor">Tensor</span>, &#39; batch seq_len&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Can depend on the model type.
For ILM and IDLM: 0 for CLS, 1 for BOS and prefix, 2 for other tokens.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.datamodule.BaseCollatorInput" class="doc doc-heading">
            <code>BaseCollatorInput</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.TypedDict">TypedDict</span></code></p>



        <p>Dict with values that are lists of raw input_ids of variable length.</p>
<p>This is the input to the collator for pre-training.</p>
<p>The elements of the lists can be of different lengths.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="xlm.datamodule.BaseCollatorInput.input_ids">input_ids</span></code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input ids.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.datamodule.BaseDataModule" class="doc doc-heading">
            <code>BaseDataModule</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="lightning.LightningDataModule">LightningDataModule</span></code></p>



        <p>Base class for all datamodules.</p>











<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="xlm.datamodule.BaseDataModule.tokenizer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tokenizer</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>The tokenizer.[Required]</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="xlm.datamodule.BaseDataModule.print_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">print_batch</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">split</span><span class="p">,</span> <span class="n">dataloader_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Required to print train and validation batches at the beginning of the epoch.</p>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.datamodule.DefaultCollator" class="doc doc-heading">
            <code>DefaultCollator</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="xlm.datamodule.Collator">Collator</span></code></p>



        <p>Simply stacks the input_ids, attention_mask, and token_type_ids and returns a batch.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.datamodule.DefaultCollatorWithDynamicPadding" class="doc doc-heading">
            <code>DefaultCollatorWithDynamicPadding</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="DefaultCollatorWithPadding (xlm.datamodule.DefaultCollatorWithPadding)" href="#xlm.datamodule.DefaultCollatorWithPadding">DefaultCollatorWithPadding</a></code></p>



        <p>Like DefaultCollator, but pads to the max length in the batch.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.datamodule.DefaultCollatorWithPadding" class="doc doc-heading">
            <code>DefaultCollatorWithPadding</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="DefaultCollator (xlm.datamodule.DefaultCollator)" href="#xlm.datamodule.DefaultCollator">DefaultCollator</a></code></p>



        <p>Like DefaultCollator, but pads (truncates if needed) the input_ids, attention_mask, and token_type_ids to self.max_length.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.datamodule.DefaultEmptyDataset" class="doc doc-heading">
            <code>DefaultEmptyDataset</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.utils.data.IterableDataset">IterableDataset</span></code></p>













<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.datamodule.DefaultEmptyDataset.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">tokenizer</span><span class="p">,</span> <span class="n">num_examples</span><span class="p">,</span> <span class="n">tokenizer_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">empty_text</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tokenizer_kwargs</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Keyword arguments for the tokenizer.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>empty_text</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>For MLM, you will want to set the <code>empty_text</code> to a sequence of all mask tokens.</p>
              </div>
            </td>
            <td>
                  <code>&#39;&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.datamodule.Seq2SeqCollatorInput" class="doc doc-heading">
            <code>Seq2SeqCollatorInput</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.TypedDict">TypedDict</span></code></p>



        <p>Dict with values that are lists of raw input_ids, attention_mask, and token_type_ids.</p>
<p>This is the input to the collator for pre-training.</p>
<p>The elements of the lists can be of different lengths.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="xlm.datamodule.Seq2SeqCollatorInput.input_ids">input_ids</span></code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input ids.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="xlm.datamodule.Seq2SeqCollatorInput.prompt_ids">prompt_ids</span></code></td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The target ids.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.datamodule.SimpleSpaceTokenizer" class="doc doc-heading">
            <code>SimpleSpaceTokenizer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="transformers.PreTrainedTokenizer">PreTrainedTokenizer</span></code></p>



        <p>Splits on spaces</p>











<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.datamodule.SimpleSpaceTokenizer.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">vocab</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vocab</code>
            </td>
            <td>
                  <code><span title="typing.Sequence">Sequence</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of desired tokens. Following are list of all of the special tokens with
their corresponding ids:
    "[PAD]": 0,
    "[UNK]": 1,
    "[MASK]": 2,
    "[EOS]": 3,
    "[BOS]": 4,
an id (starting at 5) will be assigned to each character.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model_max_length</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model maximum sequence length.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.datamodule.TokenizerMixin" class="doc doc-heading">
            <code>TokenizerMixin</code>


</h2>


    <div class="doc doc-contents ">



        <ol>
<li>Adds a <code>full_vocab_size</code> property.</li>
<li>provides a <code>post_creation</code> method that should be called after creating the tokenizer.
  to ensure all the special tokens are present.</li>
</ol>











<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.datamodule.TokenizerMixin.post_creation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">post_creation</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check the presence of the special tokens and update the post processor.</p>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.datamodule.UnconditionalGenerationDatasetManager" class="doc doc-heading">
            <code>UnconditionalGenerationDatasetManager</code>


</h2>


    <div class="doc doc-contents ">



        <p>This is used for unconditional generation, where we don't have any input text.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="xlm.datamodule.ids_to_example_fn" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ids_to_example_fn</span><span class="p">(</span><span class="n">example</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">,</span> <span class="n">block_size</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Convert raw token_ids to input_ids, attention_mask, and token_type_ids.</p>


<details class="does" open>
  <summary>Does</summary>
  <ol>
<li>Calls <code>tokenizer.build_inputs_with_special_tokens</code> and <code>tokenizer.create_token_type_ids_from_sequences</code>
    to produce <code>input_ids</code> and <code>token_type_ids</code>.</li>
<li>Creates an <code>attention_mask</code> of all ones.</li>
</ol>
</details>

<details class="does-not-do" open>
  <summary>Does not do</summary>
  <ol>
<li>Padding/truncation.</li>
</ol>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>example</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="typing.Literal">Literal</span>[&#39;token_ids&#39;], <span title="typing.List">List</span>[<span title="int">int</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary with a "token_ids" key, and value which is a list of token ids.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tokenizer</code>
            </td>
            <td>
                  <code><span title="transformers.PreTrainedTokenizerBase">PreTrainedTokenizerBase</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tokenizer that implements <code>PretrainedTokenizerBase</code> interface.
Specifically, it should have <code>build_inputs_with_special_tokens</code> and
<code>create_token_type_ids_from_sequences</code> methods overridden if the default
implementations are not correct.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>block_size</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The block size to pad/truncate the input_ids to.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    A dictionary with "input_ids", "attention_mask", and "token_type_ids" keys.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.datamodule.pad_prefix_suffix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pad_prefix_suffix</span><span class="p">(</span><span class="n">tokenizer</span><span class="p">,</span> <span class="n">examples</span><span class="p">,</span> <span class="n">max_seq_len</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>[<varibale prefix>][<bos> <variable suffix> <eos>]</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.datamodule.pad_prefix_suffix2" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pad_prefix_suffix2</span><span class="p">(</span><span class="n">examples</span><span class="p">,</span> <span class="n">max_seq_len</span><span class="p">,</span> <span class="n">pad_token_id</span><span class="p">,</span> <span class="n">bos_token_id</span><span class="p">,</span> <span class="n">eos_token_id</span><span class="p">,</span> <span class="n">prefix_type_extension</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">suffix_type_extension</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>[<varibale prefix>][<bos> <variable suffix> <eos>]</p>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="xlm.metrics"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="xlm.metrics.ExactMatch" class="doc doc-heading">
            <code>ExactMatch</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torchmetrics.MeanMetric">MeanMetric</span></code></p>













<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.metrics.ExactMatch.update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">pred_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">target_length</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pred</code>
            </td>
            <td>
                  <code><span title="jaxtyping.Integer">Integer</span>[<span title="torch.Tensor">Tensor</span>, &#39; *batch seq_len&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predicted tokens</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code><span title="jaxtyping.Integer">Integer</span>[<span title="torch.Tensor">Tensor</span>, &#39; *batch seq_len&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>target tokens</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pred_length</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="jaxtyping.Integer">Integer</span>[<span title="torch.Tensor">Tensor</span>, &#39; *batch&#39;]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>length of the predicted tokens</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_length</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="jaxtyping.Integer">Integer</span>[<span title="torch.Tensor">Tensor</span>, &#39; *batch&#39;]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>length of the target tokens</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.metrics.MetricWrapper" class="doc doc-heading">
            <code>MetricWrapper</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>



        <p>Unified metric wrapper that works with both Lightning trainer and Fabric.</p>
<p>Sends the raw <code>batch</code> and <code>loss_dict</code> output to the <code>update_fn</code> which transforms it into a dict of kwargs for the <code>metric</code>. The <code>update_fn</code> can contain task specific and model specific logic.</p>
<p>For Lightning: Use the <code>log</code> method to log metrics via LightningModule.
For Fabric: Use <code>compute</code> and <code>get_log_dict</code> methods for manual logging.</p>











<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="xlm.metrics.MetricWrapper.full_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">full_name</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Get the full metric name with prefix.</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="xlm.metrics.MetricWrapper.compute" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Compute the current metric value. Useful for Fabric-based training.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.metrics.MetricWrapper.get_log_dict" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_log_dict</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get a dictionary with the metric name and computed value for logging. Useful for Fabric-based training.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.metrics.MetricWrapper.log" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">log</span><span class="p">(</span><span class="n">pl_module</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">metrics</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Log the metric using Lightning's logging mechanism.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.metrics.MetricWrapper.reset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reset</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Reset the metric state.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.metrics.MetricWrapper.update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">loss_dict</span><span class="p">,</span> <span class="n">tokenizer</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Update the metric with the current batch and loss_dict.</p>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.metrics.TokenAccuracy" class="doc doc-heading">
            <code>TokenAccuracy</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torchmetrics.MeanMetric">MeanMetric</span></code></p>













<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.metrics.TokenAccuracy.update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">pred_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pred</code>
            </td>
            <td>
                  <code><span title="jaxtyping.Integer">Integer</span>[<span title="torch.Tensor">Tensor</span>, &#39; *batch seq_len&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predicted tokens</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code><span title="jaxtyping.Integer">Integer</span>[<span title="torch.Tensor">Tensor</span>, &#39; *batch seq_len&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>target tokens</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pred_mask</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="jaxtyping.Integer">Integer</span>[<span title="torch.Tensor">Tensor</span>, &#39; *batch seq_len&#39;]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True for positions that predicted.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="xlm.metrics.exact_match_update_fn" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">exact_match_update_fn</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">loss_dict</span><span class="p">,</span> <span class="n">tokenizer</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>batch</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict[str, Any]. Should contain the following keys:
- "target_ids": Integer[TT, " *batch target_seq_len"]</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>loss_dict</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict[str, Any]. Should contain the following keys:
- "ids": Integer[TT, " *batch input_seq_len+target_seq_len"]</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.metrics.seq2seq_exact_match_update_fn" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">seq2seq_exact_match_update_fn</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">loss_dict</span><span class="p">,</span> <span class="n">tokenizer</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>batch</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict[str, Any]. Should contain the following keys:
- "target_ids": Integer[TT, " <em>batch target_seq_len"]
- "input_ids": Integer[TT, " </em>batch input_seq_len"]</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>loss_dict</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict[str, Any]. Should contain the following keys:
- "ids": Integer[TT, " *batch input_seq_len+target_seq_len"]</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Note: We rely on having same number right pads in target and pred, which may not be true for ARLM.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.metrics.seq2seq_token_accuracy_update_fn" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">seq2seq_token_accuracy_update_fn</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">loss_dict</span><span class="p">,</span> <span class="n">tokenizer</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>batch</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict[str, Any]. Should contain the following keys:
- "target_ids": Integer[TT, " <em>batch target_seq_len"]
- "input_ids": Integer[TT, " </em>batch input_seq_len"]</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>loss_dict</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict[str, Any]. Should contain the following keys:
- "ids": Integer[TT, " *batch input_seq_len+target_seq_len"]</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="xlm.noise"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="xlm.flags"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">












  </div>

    </div>

</div><h2 id="commands">Commands</h2>


<div class="doc doc-object doc-module">



<a id="xlm.commands.lightning_train"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="xlm.commands.lightning_generate"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="xlm.commands.lightning_generate.instantiate_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">instantiate_model</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">datamodule</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">



<details class="supports-two-modes" open>
  <summary>Supports two modes</summary>
  <ol>
<li>Load a model from full training checkpoint using <code>lightning_module.load_from_checkpoint(cfg.generation.ckpt_path)</code></li>
<li>Load a model from model only checkpoint using <code>lightning_module.model.load_state_dict(torch.load(cfg.generation.model_only_checkpoint_path))</code></li>
</ol>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cfg</code>
            </td>
            <td>
                  <code><span title="omegaconf.DictConfig">DictConfig</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hydra config</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>generation_ckpt_path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the generation checkpoint</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>datamodule</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Datamodule</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="xlm.commands.lightning_eval"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="xlm.commands.lightning_eval.instantiate_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">instantiate_model</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">datamodule</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Instantiate and load a model for evaluation.</p>


<details class="supports-two-modes" open>
  <summary>Supports two modes</summary>
  <ol>
<li>Load a model from full training checkpoint using <code>lightning_module.load_from_checkpoint(cfg.eval.checkpoint_path)</code></li>
<li>Load a model from model only checkpoint using <code>lightning_module.model.load_state_dict(torch.load(cfg.eval.model_only_checkpoint_path))</code></li>
</ol>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cfg</code>
            </td>
            <td>
                  <code><span title="omegaconf.DictConfig">DictConfig</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hydra config</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>datamodule</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Datamodule</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tokenizer</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tokenizer</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="Harness (xlm.harness.Harness)" href="#xlm.harness.Harness">Harness</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of (lightning_module, ckpt_path) where ckpt_path is the full checkpoint path</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>(or None if using model-only checkpoint)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="xlm.commands.lightning_prepare_data"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="xlm.commands.push_to_hub"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="xlm.commands.push_to_hub.PushToHubConfig" class="doc doc-heading">
            <code>PushToHubConfig</code>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">



        <p>Configuration for pushing model to Hugging Face Hub.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="xlm.commands.push_to_hub.instantiate_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">instantiate_model</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">datamodule</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Instantiate a model from checkpoint or config.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cfg</code>
            </td>
            <td>
                  <code><span title="omegaconf.DictConfig">DictConfig</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Hydra config</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>datamodule</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Datamodule instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tokenizer</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tokenizer instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>Harness</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Harness (xlm.harness.Harness)" href="#xlm.harness.Harness">Harness</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The instantiated model</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.commands.push_to_hub.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Main function for Push to Hub.</p>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="xlm.commands.scaffold_model"></a>
    <div class="doc doc-contents first">

        <p>Script to scaffold a new external language model for the XLM framework.</p>
<p>Usage: xlm-scaffold <model_name> [options]</p>
<p>This script creates a complete external model structure with:
- Python package with skeleton implementations
- Configuration files for all necessary components
- Documentation and examples</p>










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="xlm.commands.scaffold_model.create_template_context" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_template_context</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Create template context with all necessary variables.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.commands.scaffold_model.generate_config_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_config_files</span><span class="p">(</span><span class="n">config_dir</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">is_core</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate all configuration files.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.commands.scaffold_model.generate_datamodule_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_datamodule_file</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate the datamodule_<model_name>.py file with data processing logic.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.commands.scaffold_model.generate_documentation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_documentation</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate README and documentation.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.commands.scaffold_model.generate_init_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_init_file</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="n">context</span><span class="p">,</span> <span class="n">is_core</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate the <strong>init</strong>.py file.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.commands.scaffold_model.generate_loss_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_loss_file</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate the loss_{model_name}.py file with loss computation.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.commands.scaffold_model.generate_metrics_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_metrics_file</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate the metrics_{model_name}.py file with metric computation logic.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.commands.scaffold_model.generate_model_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_model_file</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate the model_{model_name}.py file with the neural network implementation.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.commands.scaffold_model.generate_predictor_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_predictor_file</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate the predictor_{model_name}.py file with inference logic.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.commands.scaffold_model.generate_setup_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_setup_file</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate setup.py for the external model.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.commands.scaffold_model.generate_types_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_types_file</span><span class="p">(</span><span class="n">model_dir</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate the types_{model_name}.py file with TypedDict definitions.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.commands.scaffold_model.update_xlm_models_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_xlm_models_file</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">xlm_models_path</span><span class="o">=</span><span class="n">Path</span><span class="p">(</span><span class="s1">&#39;xlm_models.json&#39;</span><span class="p">))</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Add the new model to the xlm_models.json file.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.commands.scaffold_model.validate_model_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_model_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Validate and normalize model name.</p>


    </div>

</div>



  </div>

    </div>

</div><h2 id="modules">Modules</h2>


<div class="doc doc-object doc-module">



<a id="xlm.modules.rotary_transformer"></a>
    <div class="doc doc-contents first">

        <p>Modules for simple transformer decoder that uses rotary embeddings for positional encoding.</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="xlm.modules.rotary_transformer.RotaryTransformerFinalLayer" class="doc doc-heading">
            <code>RotaryTransformerFinalLayer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>



        <p>Simple unembedding layer with optional layer norm.</p>











<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.modules.rotary_transformer.RotaryTransformerFinalLayer.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the input tensor of shape (bsz, seq_len, dim).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.modules.rotary_transformer.RotaryTransformerFinalLayerForClassification" class="doc doc-heading">
            <code>RotaryTransformerFinalLayerForClassification</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>



        <p>Feedforward layer with pre-norm and residual connection followed by a linear layer for classification.</p>











<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.modules.rotary_transformer.RotaryTransformerFinalLayerForClassification.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the input tensor of shape (bsz, seq_len, dim).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.modules.rotary_transformer.RotaryTransformerLayer" class="doc doc-heading">
            <code>RotaryTransformerLayer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>



        <p>One layer of DDiT.</p>
<p>It consists of a multi-head self-attention layer followed by a feedforward layer with normalization and gating in between.</p>











<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.modules.rotary_transformer.RotaryTransformerLayer.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">d_model</span><span class="p">,</span> <span class="n">nhead</span><span class="p">,</span> <span class="n">dim_feedforward</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dropout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">layer_norm_eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">force_flash_attn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize the DDiTBlock.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>d_model</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the dimension of the input.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nhead</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the number of attention heads.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mlp_ratio</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the ratio of the hidden size of the MLP/feedforward layer to the input size.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dropout</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the dropout rate.</p>
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.modules.rotary_transformer.RotaryTransformerLayer.apply_rotary_pos_emb" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_rotary_pos_emb</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the input tensor of shape (batch_size, seq_len, num_heads, dim).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tensor with rotary position embeddings applied to the first dim/2 of the last dimension.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.modules.rotary_transformer.RotaryTransformerLayer.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">inp</span><span class="p">,</span> <span class="n">attention_mask</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the input tensor of shape (bsz, seq_len, dim).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>attention_mask</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the attention mask of shape (bsz, seq_len), which is True for non-padding tokens.
It can also be of shape (bsz, seq_len (query), seq_len (key-value)), where the mask indicates which tokens are valid in the context.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.modules.rotary_transformer.RotaryTransformerLayerList" class="doc doc-heading">
            <code>RotaryTransformerLayerList</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.ModuleList">ModuleList</span></code></p>



        <p>A module list of DDiT blocks that share the rotary cache for the rotary embeddings.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="xlm.modules.rotary_transformer.add_bias_apply_dropout_scale" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_bias_apply_dropout_scale</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dropout</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">residual</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Adds bias, applies dropout, scales, and adds residual.</p>
<p>TODO: Consider creating fused implementation using jit and two wrappers
Args:
    x: The input tensor of shape (bsz, seq_len, dim).
    bias: The bias tensor of shape (bsz, 1, dim).
    dropout: The dropout rate.
    scale: The scale tensor of shape (bsz, 1, dim).
    residual: The residual tensor of shape (bsz, seq_len, dim).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The output tensor of shape (bsz, seq_len, dim).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="xlm.modules.gpt2_transformer"></a>
    <div class="doc doc-contents first">

        <p>Adapted from MINGPT: https://github.com/karpathy/nanoGPT/blob/master/model.py</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="xlm.modules.gpt2_transformer.GPT" class="doc doc-heading">
            <code>GPT</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>













<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.modules.gpt2_transformer.GPT.estimate_mfu" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">estimate_mfu</span><span class="p">(</span><span class="n">fwdbwd_per_iter</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>estimate model flops utilization (MFU) in units of A100 bfloat16 peak FLOPS</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.modules.gpt2_transformer.GPT.get_num_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_num_params</span><span class="p">(</span><span class="n">non_embedding</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return the number of parameters in the model.
For non-embedding count (default), the position embeddings get subtracted.
The token embeddings would too, except due to the parameter sharing these
params are actually used as weights in the final layer, so we include them.</p>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.modules.gpt2_transformer.LayerNorm" class="doc doc-heading">
            <code>LayerNorm</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>



        <p>LayerNorm but with an optional bias. PyTorch doesn't support simply bias=False</p>











<div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="xlm.modules.encoder"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="xlm.modules.encoder.DiffusionTransformerEncoder" class="doc doc-heading">
            <code>DiffusionTransformerEncoder</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>













<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.modules.encoder.DiffusionTransformerEncoder.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">src_tokens</span><span class="p">,</span> <span class="n">src_lengths</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>src_tokens</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>shape (B, T)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>src_lengths</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>shape (B) of type LongTensor</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.modules.encoder.DiffusionTransformerEncoderLayer" class="doc doc-heading">
            <code>DiffusionTransformerEncoderLayer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>













<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.modules.encoder.DiffusionTransformerEncoderLayer.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">src_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">src_key_padding_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>src</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>shape (B, T, d_model) for now we will assume T=query_seq_len=key_seq_len</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>src_mask</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>shape (B*num_heads, T, T) or (T, T). True is attend, False is not attend
Note that nn.TransformerEncoderLayer will allow float masks which are added to
the attention scores. But we only support boolean masks here.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>src_key_padding_mask</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>shape (B, T) or (T). True is attend, False is masked</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="xlm.modules.ddit_simple"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="xlm.modules.ddit_simple.AdaLNModulations" class="doc doc-heading">
            <code>AdaLNModulations</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>



        <p>Produces the modulation parameters for AdaLN.</p>











<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple.AdaLNModulations.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">cond_dim</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">num_modulation_parameters</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initializes the AdaLNModulations module.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cond_dim</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dimension of the conditioning input.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dim</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The hidden size.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple.AdaLNModulations.ada_ln_modulate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ada_ln_modulate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Applies adaLN modulation to the input tensor.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input tensor of shape (bsz, seq_len, dim).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shift</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The shift parameter tensor of shape (bsz, 1, dim).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scale</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The scale parameter tensor of shape (bsz, 1, dim).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The modulated output tensor of shape (bsz, seq_len, dim).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple.AdaLNModulations.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">c</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Forward pass of the AdaLNModulations module.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>c</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The conditioning input tensor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[torch.Tensor]: The modulation parameters for AdaLN.
Each tensor has shape (bsz, 1, dim). When num_modulation_paramters=6, these tensors stand for
the shift and scale parameters for the MHA and MLP layers, and the gating parameters:
shift_msa, scale_msa, gate_msa, shift_mlp, scale_mlp, gate_mlp.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.modules.ddit_simple.DDiTLayer" class="doc doc-heading">
            <code>DDiTLayer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>



        <p>One layer of DDiT.</p>
<p>It consists of a multi-head self-attention layer followed by a feedforward layer with adaLN and gating in between.</p>











<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple.DDiTLayer.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">d_model</span><span class="p">,</span> <span class="n">nhead</span><span class="p">,</span> <span class="n">dim_feedforward</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dropout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">layer_norm_eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">d_cond</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force_flash_attn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize the DDiTBlock.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>d_model</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the dimension of the input.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nhead</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the number of attention heads.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>d_cond</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the dimension of the conditioning input.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mlp_ratio</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the ratio of the hidden size of the MLP/feedforward layer to the input size.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dropout</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the dropout rate.</p>
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple.DDiTLayer.apply_rotary_pos_emb" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_rotary_pos_emb</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the input tensor of shape (batch_size, seq_len, num_heads, dim).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tensor with rotary position embeddings applied to the first dim/2 of the last dimension.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple.DDiTLayer.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">attention_mask</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the input tensor of shape (bsz, seq_len, dim).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>c</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the conditioning input of shape (bsz, cond_dim).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>attention_mask</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the attention mask of shape (bsz, seq_len), which is True for non-padding tokens.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.modules.ddit_simple.DDiTLayerList" class="doc doc-heading">
            <code>DDiTLayerList</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.ModuleList">ModuleList</span></code></p>



        <p>A module list of DDiT blocks that share the rotary cache for the rotary embeddings.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.modules.ddit_simple.DDitFinalLayer" class="doc doc-heading">
            <code>DDitFinalLayer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>













<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple.DDitFinalLayer.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the input tensor of shape (bsz, seq_len, dim).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>c</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the conditioning input of shape (bsz, cond_dim).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.modules.ddit_simple.LabelEmbedder" class="doc doc-heading">
            <code>LabelEmbedder</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>



        <p>Embeds class labels into vector representations. Also handles label dropout for classifier-free guidance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>num_classes</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of classes.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cond_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The size of the conditioning input.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>label_dropout</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dropout rate for class labels during training.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="xlm.modules.ddit_simple.LabelEmbedder.embedding_table">embedding_table</span></code></td>
            <td>
                  <code><span title="torch.nn.Embedding">Embedding</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The embedding table for class labels.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="xlm.modules.ddit_simple.LabelEmbedder.num_classes">num_classes</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of classes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>











<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple.LabelEmbedder.drop_labels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">drop_labels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Drop out class labels during training.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>labels</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input tensor of class labels of shape (bsz,).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>torch.Tensor: The modified class labels with some labels dropped by setting to the missing (last label).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple.LabelEmbedder.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Forward pass of the LabelEmbedder module.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>labels</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input tensor of class labels of shape (bsz,).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>torch.Tensor: The embedded vector representations of the class labels.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.modules.ddit_simple.LayerNormAndScale" class="doc doc-heading">
            <code>LayerNormAndScale</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>



        <p>Performs normalization and just scaling (no bias).</p>











<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple.LayerNormAndScale.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dim</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the dimension of the input.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple.LayerNormAndScale.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the input tensor of shape (bsz, seq_len, dim).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the normalized and scaled output tensor of shape (bsz, seq_len, dim).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.modules.ddit_simple.TimestepEmbedder" class="doc doc-heading">
            <code>TimestepEmbedder</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>



        <p>Embeds scalar timesteps into vector representations.</p>











<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple.TimestepEmbedder.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">,</span> <span class="n">frequency_embedding_size</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">max_period</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hidden_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The size of the hidden layer and the output of MLP.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>frequency_embedding_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The size of the frequency embedding layer.</p>
              </div>
            </td>
            <td>
                  <code>256</code>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple.TimestepEmbedder.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">t</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Embeds scalar timesteps into vector representations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>t</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 1-D Tensor of bsz indices, one per batch element. These may be fractional.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An (bsz, hidden_size) Tensor of positional embeddings.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="xlm.modules.ddit_simple.add_bias_apply_dropout_scale" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_bias_apply_dropout_scale</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dropout</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">residual</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Adds bias, applies dropout, scales, and adds residual.</p>
<p>TODO: Consider creating fused implementation using jit and two wrappers
Args:
    x: The input tensor of shape (bsz, seq_len, dim).
    bias: The bias tensor of shape (bsz, 1, dim).
    dropout: The dropout rate.
    scale: The scale tensor of shape (bsz, 1, dim).
    residual: The residual tensor of shape (bsz, seq_len, dim).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The output tensor of shape (bsz, seq_len, dim).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="xlm.modules.ddit_simple_v2"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="xlm.modules.ddit_simple_v2.AdaLNModulations" class="doc doc-heading">
            <code>AdaLNModulations</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>



        <p>Produces the modulation parameters for AdaLN.</p>











<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple_v2.AdaLNModulations.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">cond_dim</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">num_modulation_parameters</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initializes the AdaLNModulations module.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cond_dim</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dimension of the conditioning input.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dim</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The hidden size.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple_v2.AdaLNModulations.ada_ln_modulate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ada_ln_modulate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">shift</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Applies adaLN modulation to the input tensor.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input tensor of shape (bsz, seq_len, dim).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shift</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The shift parameter tensor of shape (bsz, 1, dim).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scale</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The scale parameter tensor of shape (bsz, 1, dim).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The modulated output tensor of shape (bsz, seq_len, dim).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple_v2.AdaLNModulations.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">c</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Forward pass of the AdaLNModulations module.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>c</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The conditioning input tensor.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="torch.Tensor">Tensor</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[torch.Tensor]: The modulation parameters for AdaLN.
Each tensor has shape (bsz, 1, dim). When num_modulation_paramters=6, these tensors stand for
the shift and scale parameters for the MHA and MLP layers, and the gating parameters:
shift_msa, scale_msa, gate_msa, shift_mlp, scale_mlp, gate_mlp.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.modules.ddit_simple_v2.DDiTLayer" class="doc doc-heading">
            <code>DDiTLayer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>



        <p>One layer of DDiT.</p>
<p>It consists of a multi-head self-attention layer followed by a feedforward layer with adaLN and gating in between.</p>











<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple_v2.DDiTLayer.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">d_model</span><span class="p">,</span> <span class="n">nhead</span><span class="p">,</span> <span class="n">dim_feedforward</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dropout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s1">&#39;relu&#39;</span><span class="p">,</span> <span class="n">layer_norm_eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">d_cond</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force_flash_attn</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Initialize the DDiTBlock.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>d_model</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the dimension of the input.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nhead</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the number of attention heads.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>d_cond</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the dimension of the conditioning input.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mlp_ratio</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the ratio of the hidden size of the MLP/feedforward layer to the input size.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dropout</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the dropout rate.</p>
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple_v2.DDiTLayer.apply_rotary_pos_emb" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_rotary_pos_emb</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the input tensor of shape (batch_size, seq_len, num_heads, dim).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tensor with rotary position embeddings applied to the first dim/2 of the last dimension.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple_v2.DDiTLayer.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">attention_mask</span><span class="p">,</span> <span class="n">positions</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the input tensor of shape (bsz, seq_len, dim).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>c</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the conditioning input of shape (bsz, cond_dim).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>attention_mask</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the attention mask of shape (bsz, seq_len), which is True for non-padding tokens.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.modules.ddit_simple_v2.DDiTLayerList" class="doc doc-heading">
            <code>DDiTLayerList</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.ModuleList">ModuleList</span></code></p>



        <p>A module list of DDiT blocks that share the rotary cache for the rotary embeddings.</p>











<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.modules.ddit_simple_v2.DDitFinalLayer" class="doc doc-heading">
            <code>DDitFinalLayer</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>













<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple_v2.DDitFinalLayer.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the input tensor of shape (bsz, seq_len, dim).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>c</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the conditioning input of shape (bsz, cond_dim).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.modules.ddit_simple_v2.DDitFinalLayerForClassification" class="doc doc-heading">
            <code>DDitFinalLayerForClassification</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>













<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple_v2.DDitFinalLayerForClassification.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the input tensor of shape (bsz, seq_len, dim).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>c</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the conditioning input of shape (bsz, cond_dim).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.modules.ddit_simple_v2.DDitFinalLayerWithoutNormalization" class="doc doc-heading">
            <code>DDitFinalLayerWithoutNormalization</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>













<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple_v2.DDitFinalLayerWithoutNormalization.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the input tensor of shape (bsz, seq_len, dim).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>c</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the conditioning input of shape (bsz, cond_dim).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.modules.ddit_simple_v2.LabelEmbedder" class="doc doc-heading">
            <code>LabelEmbedder</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>



        <p>Embeds class labels into vector representations. Also handles label dropout for classifier-free guidance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>num_classes</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of classes.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cond_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The size of the conditioning input.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>label_dropout</code>
            </td>
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dropout rate for class labels during training.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="xlm.modules.ddit_simple_v2.LabelEmbedder.embedding_table">embedding_table</span></code></td>
            <td>
                  <code><span title="torch.nn.Embedding">Embedding</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The embedding table for class labels.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="xlm.modules.ddit_simple_v2.LabelEmbedder.num_classes">num_classes</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of classes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>











<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple_v2.LabelEmbedder.drop_labels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">drop_labels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Drop out class labels during training.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>labels</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input tensor of class labels of shape (bsz,).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>torch.Tensor: The modified class labels with some labels dropped by setting to the missing (last label).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple_v2.LabelEmbedder.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Forward pass of the LabelEmbedder module.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>labels</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The input tensor of class labels of shape (bsz,).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>torch.Tensor: The embedded vector representations of the class labels.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.modules.ddit_simple_v2.LayerNormAndScale" class="doc doc-heading">
            <code>LayerNormAndScale</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>



        <p>Performs normalization and just scaling (no bias).</p>











<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple_v2.LayerNormAndScale.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dim</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the dimension of the input.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple_v2.LayerNormAndScale.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the input tensor of shape (bsz, seq_len, dim).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the normalized and scaled output tensor of shape (bsz, seq_len, dim).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.modules.ddit_simple_v2.TimestepEmbedder" class="doc doc-heading">
            <code>TimestepEmbedder</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>



        <p>Embeds scalar timesteps into vector representations.</p>











<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple_v2.TimestepEmbedder.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">,</span> <span class="n">frequency_embedding_size</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">max_period</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hidden_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The size of the hidden layer and the output of MLP.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>frequency_embedding_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The size of the frequency embedding layer.</p>
              </div>
            </td>
            <td>
                  <code>256</code>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.modules.ddit_simple_v2.TimestepEmbedder.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">t</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Embeds scalar timesteps into vector representations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>t</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 1-D Tensor of bsz indices, one per batch element. These may be fractional.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An (bsz, hidden_size) Tensor of positional embeddings.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="xlm.modules.ddit_simple_v2.add_bias_apply_dropout_scale" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_bias_apply_dropout_scale</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dropout</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">residual</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">training</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Adds bias, applies dropout, scales, and adds residual.</p>
<p>TODO: Consider creating fused implementation using jit and two wrappers
Args:
    x: The input tensor of shape (bsz, seq_len, dim).
    bias: The bias tensor of shape (bsz, 1, dim).
    dropout: The dropout rate.
    scale: The scale tensor of shape (bsz, 1, dim).
    residual: The residual tensor of shape (bsz, seq_len, dim).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The output tensor of shape (bsz, seq_len, dim).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="xlm.modules.position"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="xlm.modules.position.RotaryEmbedding" class="doc doc-heading">
            <code>RotaryEmbedding</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="torch.nn.Module">Module</span></code></p>













<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.modules.position.RotaryEmbedding.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">head_first</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cache_size</span><span class="o">=</span><span class="mi">1024</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dim</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the dimension of the input.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>head_first</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>if True, the input is assumed to be of shape (batch_size, seq_len, num_heads, dim)
        if False, the input is assumed to be of shape (batch_size, num_heads, seq_len, dim)</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cache_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the maximum sequence length to cache the sine and cosine values for.</p>
              </div>
            </td>
            <td>
                  <code>1024</code>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.modules.position.RotaryEmbedding.forward" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">positions</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">



<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>shape (batch_size, seq_len, num_heads, dim) if head_first is False
shape (batch_size, num_heads, seq_len, dim) if head_first is True</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>positions</code>
            </td>
            <td>
                  <code><span title="jaxtyping.Integer">Integer</span>[<span title="torch.Tensor">Tensor</span>, &#39; *batch seq_len&#39;]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>shape (batch_size, seq_len)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><h2 id="tasks">Tasks</h2>


<div class="doc doc-object doc-module">



<a id="xlm.tasks.owt"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="xlm.tasks.lm1b"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="xlm.tasks.lm1b.detokenizer_lm1b_string" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">detokenizer_lm1b_string</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Detokenizer for the LM1B dataset.
Same as the one used in SEDD and MDLM.</p>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="xlm.tasks.star"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="xlm.tasks.star.plot_graph" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_graph</span><span class="p">(</span><span class="n">edge_list</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">goal</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Example usage:
graph = simple_star_graph(4, 4, 20)
plot_graph(graph["edge_list"], graph["path"], graph["source"], graph["goal"])</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.tasks.star.simple_star_graph" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">simple_star_graph</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">pathlength</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">vocab_size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Generate a asymmetric star graph.</p>
<h3 id="xlm.tasks.star.simple_star_graph--adapted-from-httpsgithubcomgregorbachmannnext-token-failuresblobmaindatagraphspy">Adapted from : https://github.com/gregorbachmann/Next-Token-Failures/blob/main/data/graphs.py</h3>


<details class="properties" open>
  <summary>Properties</summary>
  <ul>
<li>The source is always the center of the star.</li>
<li>The goal is always the end of one of the arms of the star.</li>
<li>No nodes are repeated in the graph.
    So pathlength * degree + 1  should be greater than or equal to vocab_size otherwise the
    code will loop indefinitely.</li>
</ul>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>degree</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>int, number of edges from source (center of the start) to other nodes</p>
              </div>
            </td>
            <td>
                  <code>3</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pathlength</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>int, length of the path (in terms of number of nodes)</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vocab_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>int, number of nodes in the graph</p>
              </div>
            </td>
            <td>
                  <code>20</code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    path: list, path from source to goal
    edge_list: list, list of edges in the graph</p>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="xlm.tasks.molgen"></a>
    <div class="doc doc-contents first">

        <p>Molecule generation task utilities and metrics.</p>
<p>This module provides:
- Data preprocessing for SAFE molecular representations
- Conversion utilities between SAFE and SMILES formats
- Comprehensive metrics for evaluating molecular generation (diversity, QED, SA, validity, uniqueness)</p>










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="xlm.tasks.molgen.DeNovoEval" class="doc doc-heading">
            <code>DeNovoEval</code>


</h2>


    <div class="doc doc-contents ">



        <p>Post-hoc evaluator for de novo molecule generation.</p>
<p>Computes molecular properties on logged predictions at epoch end, matching
GenMol's evaluation semantics. Computes:
- Per-sample: QED, SA, SMILES (added to each prediction dict)
- Global: Diversity, Validity, Uniqueness (aggregated across all samples)</p>
<p>This approach enables:
- Global metric computation (diversity/uniqueness on full generated set)
- Exact match with GenMol's evaluation methodology
- Reusable components for other tasks (frag, lead, pmo)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>use_bracket_safe</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, decode from bracket SAFE format</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>compute_diversity</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, compute diversity metric</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>compute_validity</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, compute validity metric</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>compute_uniqueness</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, compute uniqueness metric</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>compute_qed</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, compute QED scores</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>compute_sa</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, compute SA scores</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>











<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="xlm.tasks.molgen.DeNovoEval.evaluator_diversity" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">evaluator_diversity</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Lazy load diversity evaluator.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="xlm.tasks.molgen.DeNovoEval.evaluator_uniqueness" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">evaluator_uniqueness</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Lazy load uniqueness evaluator.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="xlm.tasks.molgen.DeNovoEval.evaluator_validity" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">evaluator_validity</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Lazy load validity evaluator.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="xlm.tasks.molgen.DeNovoEval.oracle_qed" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">oracle_qed</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Lazy load QED oracle.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="xlm.tasks.molgen.DeNovoEval.oracle_sa" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">oracle_sa</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Lazy load SA oracle.</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="xlm.tasks.molgen.DeNovoEval.eval" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">eval</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">tokenizer</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Evaluate predictions and return updated predictions + aggregated metrics.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>predictions</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of prediction dicts with 'text' field containing SAFE strings</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tokenizer</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional tokenizer (not used for denovo, but kept for interface consistency)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of:</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>predictions: Updated list with per-sample metrics added (smiles, qed, sa)</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]], <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>aggregated_metrics: Dict of global metric values</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.tasks.molgen.FragmentEval" class="doc doc-heading">
            <code>FragmentEval</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="DeNovoEval (xlm.tasks.molgen.DeNovoEval)" href="#xlm.tasks.molgen.DeNovoEval">DeNovoEval</a></code></p>



        <p>Post-hoc evaluator for fragment-constrained molecule generation.</p>
<p>Extends DeNovoEval with fragment-specific metrics:
- All de novo metrics (validity, uniqueness, quality, QED, SA, diversity)
- Distance: Tanimoto distance between generated and target molecules</p>
<p>Based on GenMol's fragment evaluation methodology. Computes:
- Per-sample: QED, SA, SMILES, distance (if target available)
- Global: Diversity, Validity, Uniqueness, Quality, Distance (mean)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>use_bracket_safe</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, decode from bracket SAFE format</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>compute_diversity</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, compute diversity metric</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>compute_validity</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, compute validity metric</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>compute_uniqueness</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, compute uniqueness metric</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>compute_qed</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, compute QED scores</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>compute_sa</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, compute SA scores</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>compute_distance</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, compute Tanimoto distance to target</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>











<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.tasks.molgen.FragmentEval.eval" class="doc doc-heading">
            <code class="highlight language-python"><span class="nb">eval</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">tokenizer</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Evaluate fragment generation predictions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>predictions</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of prediction dicts with:
- 'text': Generated SAFE string (full molecule)
- 'truth': Target SAFE string (full molecule, optional)
- 'raw_input': Fragment prompt SAFE string (optional)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tokenizer</code>
            </td>
            <td>
                  <code><span title="typing.Any">Any</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional tokenizer (not used, kept for interface consistency)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple of:</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>predictions: Updated list with per-sample metrics added</li>
</ul>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]], <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <ul>
<li>aggregated_metrics: Dict of global metric values</li>
</ul>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="xlm.tasks.molgen.SerializableSAFETokenizer" class="doc doc-heading">
            <code>SerializableSAFETokenizer</code>


</h2>


    <div class="doc doc-contents ">



        <p>Wrapper around SAFE tokenizer that handles pickling/deepcopy.</p>
<p>The underlying tokenizer from the safe library has a custom PreTokenizer
that cannot be serialized. This wrapper provides dummy serialization by
storing the model path and re-instantiating the tokenizer on unpickle.</p>











<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.tasks.molgen.SerializableSAFETokenizer.__dir__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__dir__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Include both wrapper and tokenizer attributes in dir().</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.tasks.molgen.SerializableSAFETokenizer.__getattr__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__getattr__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Delegate all attribute access to the underlying tokenizer.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.tasks.molgen.SerializableSAFETokenizer.__getstate__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__getstate__</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Return state for pickling - only store the model path.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.tasks.molgen.SerializableSAFETokenizer.__setstate__" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">__setstate__</span><span class="p">(</span><span class="n">state</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Restore from pickled state - re-instantiate tokenizer.</p>


    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="xlm.tasks.molgen.bracketsafe2safe" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bracketsafe2safe</span><span class="p">(</span><span class="n">safe_str</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Convert bracket SAFE notation back to standard SAFE format.</p>
<p>Removes angle brackets from interfragment attachment points and renumbers
them to avoid conflicts with intrafragment attachment points.</p>
<p>Based on genmol/src/genmol/utils/bracket_safe_converter.py:140-153</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>safe_str</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SAFE string in bracket notation</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SAFE string in standard notation</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.tasks.molgen.genmol_fragment_preprocess_fn" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">genmol_fragment_preprocess_fn</span><span class="p">(</span><span class="n">example</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">fragment_column</span><span class="o">=</span><span class="s1">&#39;linker_design&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Preprocess GenMol fragment CSV data for fragment-constrained generation.</p>
<p>Converts SMILES fragments and targets to SAFE format, then to bracket SAFE,
and creates prompt_token_ids (fragment) and input_token_ids (full molecule).</p>
<p>Based on GenMol's fragment evaluation dataset structure:
- Input: Fragment SMILES (from <code>fragment_column</code>, default 'linker_design')
- Target: Full molecule SMILES (from 'smiles' column)</p>
<p>To use a different fragment column, pass <code>fragment_column</code> via
<code>preprocess_function_kwargs</code> in the dataset config, or set
<code>_fragment_column</code> in the example dict (overrides kwarg).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>example</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dataset example containing:
- column named by <code>fragment_column</code>: SMILES with [n*] attachment points
- 'smiles': Full target molecule SMILES
- '_fragment_column' (optional): Overrides <code>fragment_column</code> if set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tokenizer</code>
            </td>
            <td>
                  <code><span title="transformers.PreTrainedTokenizerBase">PreTrainedTokenizerBase</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tokenizer for encoding</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fragment_column</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>CSV column to use as fragment input (default: 'linker_design').
Override via datamodule ... preprocess_function_kwargs.fragment_column.</p>
              </div>
            </td>
            <td>
                  <code>&#39;linker_design&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Example with 'prompt_token_ids' (fragment) and 'input_token_ids' (full molecule)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.tasks.molgen.safe2bracketsafe" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">safe2bracketsafe</span><span class="p">(</span><span class="n">safe_str</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Convert standard SAFE notation to bracket SAFE format.</p>
<p>Bracket SAFE wraps interfragment attachment points in angle brackets.
Example: "1" -&gt; "&lt;1&gt;", "%10" -&gt; "&lt;%10&gt;"</p>
<p>Based on genmol/src/genmol/utils/bracket_safe_converter.py:133-137</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>safe_str</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SAFE string in standard notation</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SAFE string in bracket notation, or original string if conversion fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.tasks.molgen.safe_bracket_on_the_fly_processor_combined" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">safe_bracket_on_the_fly_processor_combined</span><span class="p">(</span><span class="n">example</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">,</span> <span class="n">block_size</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Works directly on the raw strings</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.tasks.molgen.safe_strings_to_smiles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">safe_strings_to_smiles</span><span class="p">(</span><span class="n">safe_strings</span><span class="p">,</span> <span class="n">use_bracket_safe</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fix</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Convert batch of SAFE strings to SMILES strings.</p>
<p>Based on genmol/src/genmol/sampler.py:81-89</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>safe_strings</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of SAFE molecular representations</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_bracket_safe</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, convert from bracket SAFE first</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fix</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, filter invalid fragments</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of SMILES strings (invalid conversions are skipped)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.tasks.molgen.safe_to_smiles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">safe_to_smiles</span><span class="p">(</span><span class="n">safe_str</span><span class="p">,</span> <span class="n">fix</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Convert SAFE string to SMILES using safe library.</p>
<p>Based on genmol/src/genmol/utils/utils_chem.py:26-30</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>safe_str</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SAFE molecular representation</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fix</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, filter out invalid fragments before decoding</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>SMILES string, or None if conversion fails</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="xlm.tasks.sudoku"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">












  </div>

    </div>

</div><h2 id="utils">Utils</h2>


<div class="doc doc-object doc-module">



<a id="xlm.utils.data"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="xlm.utils.nn"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="xlm.utils.nn.add_exp_1_noise" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_exp_1_noise</span><span class="p">(</span><span class="n">probs</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Sample from unnormalized probability using the exponential race method.
Similar to using gumbel noise, trick but we require the probs to be positive (can be unnormalized).
You can generate samples without repeatations from the output by taking argmax or topk, etc.
Args:
    probs: (<em>batch, seq_len, vocab_size) can have any number of leading dimensions.
Returns:
    (</em>batch, seq_len)</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.utils.nn.add_gumbel_noise" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_gumbel_noise</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">noise_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Add gumbel noise to logits which will result in samples from the distribtution if argmaxed.
Args:
    logits: (<em>batch, seq_len, vocab_size) can have any number of leading dimensions. Assumed to be log of exponentiated scores.
        That is, we assume logits are $l_i$ in $p_i = exp(l_i) / \sum_i \exp(l_i)$.
Returns:
    (</em>batch, seq_len)</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.utils.nn.dtype" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">dtype</span><span class="p">(</span><span class="n">string</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Convert a string to a PyTorch data type.</p>
<h3 id="xlm.utils.nn.dtype--parameters">Parameters</h3>


<details class="string-" open>
  <summary><code>str</code></summary>
  <p>The string to convert.</p>
</details>        <h3 id="xlm.utils.nn.dtype--returns">Returns</h3>
<p><code>torch.dtype</code>
    The PyTorch data type.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.utils.nn.get_mask_from_sequence_lengths" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_mask_from_sequence_lengths</span><span class="p">(</span><span class="n">sequence_lengths</span><span class="p">,</span> <span class="n">max_length</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Given a variable of shape <code>(batch_size,)</code> that represents the sequence lengths of each batch
element, this function returns a <code>(batch_size, max_length)</code> mask variable.  For example, if
our input was <code>[2, 2, 3]</code>, with a <code>max_length</code> of 4, we'd return
<code>[[1, 1, 0, 0], [1, 1, 0, 0], [1, 1, 1, 0]]</code>.</p>
<p>We require <code>max_length</code> here instead of just computing it from the input <code>sequence_lengths</code>
because it lets us avoid finding the max, then copying that value from the GPU to the CPU so
that we can use it to construct a new tensor.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.utils.nn.masked_mean" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">masked_mean</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>To calculate mean along certain dimensions on masked values</p>
<h3 id="xlm.utils.nn.masked_mean--parameters">Parameters</h3>


<details class="vector-" open>
  <summary><code>torch.Tensor</code></summary>
  <p>The vector to calculate mean.</p>
</details>        <p>mask : <code>torch.BoolTensor</code>
    The mask of the vector. It must be broadcastable with vector.
    It must be 1 for non-masked values and 0 for masked values.
dim : <code>int</code>
    The dimension to calculate mean
keepdim : <code>bool</code>
    Whether to keep dimension</p>
<h3 id="xlm.utils.nn.masked_mean--returns">Returns</h3>
<p><code>torch.Tensor</code>
    A <code>torch.Tensor</code> of including the mean values.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.utils.nn.masked_sum" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">masked_sum</span><span class="p">(</span><span class="n">vector</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">keepdim</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>To calculate sum along certain dimensions on masked values</p>
<h3 id="xlm.utils.nn.masked_sum--parameters">Parameters</h3>


<details class="vector-" open>
  <summary><code>torch.Tensor</code></summary>
  <p>The vector to calculate sum.</p>
</details>        <p>mask : <code>torch.BoolTensor</code>
    The mask of the vector. It must be broadcastable with vector. It must be 1 for non-masked values and 0 for masked out values.
dim : <code>int</code>
    The dimension to calculate sum
keepdim : <code>bool</code>
    Whether to keep dimension</p>
<h3 id="xlm.utils.nn.masked_sum--returns">Returns</h3>
<p><code>torch.Tensor</code>
    A <code>torch.Tensor</code> of including the sum values.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.utils.nn.sample_categorical" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample_categorical</span><span class="p">(</span><span class="n">probs</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Need this since torch.multinomial does not accept 3D input and cannot handle unnormalized probabilities.</p>
<p>So we implement the "exponential race method" manually which can handle any number of leading dimensions
and can handle unnormalized probabilities (not logits, )</p>
<p>Note: This is not differentiable.. Use gumbel softmax for it.
Args:
    probs: (<em>batch, seq_len, vocab_size) can have any number of leading dimensions.
        Note: probs should be positive, can be unnormalized.
Returns:
    (</em>batch, seq_len)</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.utils.nn.sample_from_logits" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample_from_logits</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">noise_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Sample from logits using the Gumbel-Max trick. Similar to sample_categorical, but works with logits (real valued).
Args:
    logits: (<em>batch, seq_len, vocab_size) can have any number of leading dimensions.
Returns:
    (</em>batch, seq_len)</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.utils.nn.sample_from_top_k" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample_from_top_k</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">logits</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Sample from the top-k logits using the Gumbel-Max trick.
Args:
    logits: (<em>batch, seq_len, vocab_size) can have any number of leading dimensions.
    k: The number of top logits to consider for sampling.
Returns:
    (</em>batch, seq_len)</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.utils.nn.sample_from_top_p" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sample_from_top_p</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">logits</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Sample from the top-p logits using the Gumbel-Max trick.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>p</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The cumulative probability threshold. Must be between 0 and 1.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>logits</code>
            </td>
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tensor of shape (*batch, seq_len, vocab_size) representing
                   the unnormalized log probabilities for each token.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="torch.Tensor">Tensor</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>torch.Tensor: A tensor of shape (*batch, seq_len) containing the sampled token indices.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.utils.nn.select_random_indices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">select_random_indices</span><span class="p">(</span><span class="n">inp_shape</span><span class="p">,</span> <span class="n">num_unmask</span><span class="p">,</span> <span class="n">select_from_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">selection_score</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">temperature</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">selection_mode</span><span class="o">=</span><span class="s1">&#39;greedy&#39;</span><span class="p">,</span> <span class="n">score_mode</span><span class="o">=</span><span class="s1">&#39;logits&#39;</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Select random indices from the last dimension using the selection_score.
1. If selection score is None then it is assumed to be uniform.
2. If score_mode = logits and selection_mode=sample, then temperature can be used to control the temperature of the distribution.
3. If select_from_mask is provided, indices only from these positions are sampled.
Args:
    inp_shape: torch.Size, typeically (batch, d)
    num_unmask: (batch,) int tensor
    select_from_mask: (batch, d) tensor, if provided, we only sample from the selected
    selection_score: logit-like score for selection (can be negative). Should match inp_shape, so typically (batch, d)
    score_mode:
        "logits" =&gt; p_i = \exp(s_i)/\sum_j \exp(s_j)
        "uprobs" =&gt; p_i = s_i / \sum_j s_j</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="xlm.utils.nn.tiny_value_of_dtype" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tiny_value_of_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Returns a moderately tiny value for a given PyTorch data type that is used to avoid numerical
issues such as division by zero.
This is different from <code>info_value_of_dtype(dtype).tiny</code> because it causes some NaN bugs.
Only supports floating point dtypes.</p>


    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="xlm.utils.ddp"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="xlm.utils.ema"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="xlm.utils.ema.EMACallback" class="doc doc-heading">
            <code>EMACallback</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="lightning.pytorch.callbacks.Callback">Callback</span></code></p>













<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="xlm.utils.ema.EMACallback.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">decay</span><span class="p">,</span> <span class="n">use_num_updates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">apply_ema_at_train_end</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>decay: The exponential decay.
use_num_updates: Whether to use number of updates when computing
    averages.
apply_ema_at_train_end: If True, applies EMA weights to the model
    at the end of training, so the final checkpoint contains
    EMA-averaged weights in the model parameters.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="xlm.utils.ema.EMACallback.on_train_end" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">on_train_end</span><span class="p">(</span><span class="n">trainer</span><span class="p">,</span> <span class="n">pl_module</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Apply EMA weights to the model at the end of training.</p>
<p>This makes the final checkpoint contain EMA-averaged weights directly
in the model parameters, eliminating the need for manual EMA application
during checkpoint extraction or inference.</p>
<p>Note: After this is called, the model's parameters will contain EMA-averaged
weights, and the original training weights will be lost (though they're
still stored in collected_params if store() was called).</p>


    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>